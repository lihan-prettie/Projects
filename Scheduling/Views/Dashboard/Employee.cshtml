@{
    ViewData["Title"] = "一般員工登入";
}

@section Styles {
    <link href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet'>
    <link href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css' rel='stylesheet'>
    <style>
        /* ===== 整體背景與日曆外觀 ===== */
        body {
            background-color: #fff8dc; /* 柔和黃色背景 */
            font-family: 'Microsoft JhengHei', sans-serif;
        }

        #calendar {
            background-color: #fff; /* 日曆白底 */
            border: 3px solid #ffd700; /* 金黃色邊框 */
            border-radius: 10px;
            padding: 10px;
            box-shadow: 0 0 10px rgba(255, 165, 0, 0.2);
            max-width: 90%;
            margin: 30px auto;
        }

        /* ===== 星期與日期顏色 ===== */
        .fc-col-header-cell-cushion,
        .fc-daygrid-day-number {
            color: #b8860b !important; /* 土黃色 */
            font-weight: 600;
        }

        /* 日期 hover 效果 */
        .fc-daygrid-day:hover {
            background-color: #ffa50033 !important; /* 淡橘色 */
            cursor: pointer;
        }

        /* 今日日期 */
        .fc-day-today {
            background-color: #ffcc80 !important; /* 橘黃底 */
            border: 2px solid #ffa500 !important;
            color: #b8860b !important;
        }

        /* 週末背景色 */
        .fc-day-sat,
        .fc-day-sun {
            background-color: #fffacd !important; /* 淺黃色 */
        }

        /* ===== 按鈕樣式 ===== */
        .fc-button {
            background-color: #ffeb3b !important; /* 亮黃 */
            color: #b8860b !important; /* 土黃字 */
            border: 1px solid #ffd700 !important;
            font-weight: 600;
            transition: 0.2s;
        }

            .fc-button:hover {
                background-color: #ffc107 !important; /* 深橘黃 */
                color: #fff8dc !important; /* 字變亮 */
            }

        /* 月份與年份置中 */
        .fc-toolbar-title {
            color: #b8860b;
            font-size: 1.6rem;
            font-weight: 700;
            text-align: center;
            flex: 1;
        }

        /* 工具列置中排列 */
        .fc-toolbar-chunk {
            display: flex;
            align-items: center;
            justify-content: center;
        }
    </style>
}

<div id="calendar"></div>

@section Scripts {
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js'></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const calendarEl = document.getElementById("calendar");
            const currentYear = new Date().getFullYear();

            // 取得 JSON 資料
            const res = await fetch(`/api/Holiday/${currentYear}`);
            const data = await res.json();

            const calendar = new FullCalendar.Calendar(calendarEl, {
                themeSystem: "bootstrap5",
                locale: "zh-tw",
                initialView: "dayGridMonth",

                headerToolbar: {
                    left: "prev today next",
                    center: "title",
                    right: ""
                },
                buttonText: { today: "今天" },

                dayCellDidMount: (info) => {
                    // ✅ 轉成本地日期字串 (避免 UTC 誤差)
                    const date = new Date(info.date.getTime() - info.date.getTimezoneOffset() * 60000);
                    const dateStr = date.toISOString().slice(0, 10).replace(/-/g, "");

                    const holiday = data.find(h => h["西元日期"] === dateStr);

                    // 清除舊樣式
                    info.el.style.backgroundColor = "";
                    info.el.style.color = "#000";

                    // 🎨 套用節日顏色與文字
                    if (holiday && holiday["是否放假"] === "2") {
                        // 顏色邏輯
                        if (holiday["星期"] === "六" || holiday["星期"] === "日") {
                            info.el.style.backgroundColor = "#fffacd"; // 淺黃
                        } else {
                            info.el.style.backgroundColor = "#ffe4b5"; // 淺橘
                        }

                        // 🏷️ 若有備註，顯示在日期格中
                        if (holiday["備註"]) {
                            const remarkEl = document.createElement("div");
                            remarkEl.textContent = holiday["備註"];
                            remarkEl.style.position = "absolute"; // ✅ 浮動定位
                            remarkEl.style.fontSize = "2rem";
                            remarkEl.style.color = "#b8860b";
                            remarkEl.style.fontWeight = "600";
                            remarkEl.style.pointerEvents = "none"; // 不影響點擊事件
                            remarkEl.style.whiteSpace = "nowrap";  // 不換行（可避免撐開）

                            // ✅ 保證容器是相對定位，才會正確定位於格內
                            const frame = info.el.querySelector(".fc-daygrid-day-frame");
                            frame.style.position = "relative";
                            frame.appendChild(remarkEl);
                        }

                    }
                }
            });

            calendar.render();
        });
    </script>
}



